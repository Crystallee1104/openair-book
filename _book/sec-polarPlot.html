<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 7 Polar plots | openair</title>
  <meta name="description" content="This will eventually form a book related to the openair R package." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 7 Polar plots | openair" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This will eventually form a book related to the openair R package." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 7 Polar plots | openair" />
  
  <meta name="twitter:description" content="This will eventually form a book related to the openair R package." />
  

<meta name="author" content="David Carslaw" />


<meta name="date" content="2020-07-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sec-percentileRose.html"/>
<link rel="next" href="sec-timeVariation.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet" />
<link href="libs/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet" />
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script>
<script src="libs/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The openair book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="sec-importAURN.html"><a href="sec-importAURN.html"><i class="fa fa-check"></i><b>3</b> Accessing UK Air Quality Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="sec-importAURN.html"><a href="sec-importAURN.html#accessing-data"><i class="fa fa-check"></i><b>3.1</b> Accessing data</a></li>
<li class="chapter" data-level="3.2" data-path="sec-importAURN.html"><a href="sec-importAURN.html#site-meta-data"><i class="fa fa-check"></i><b>3.2</b> Site Meta Data</a></li>
<li class="chapter" data-level="3.3" data-path="sec-importAURN.html"><a href="sec-importAURN.html#plot-sites-on-a-map"><i class="fa fa-check"></i><b>3.3</b> Plot Sites on a Map</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sec-worldmet.html"><a href="sec-worldmet.html"><i class="fa fa-check"></i><b>4</b> Access meteorological data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="sec-worldmet.html"><a href="sec-worldmet.html#the-worldmet-package"><i class="fa fa-check"></i><b>4.1</b> The <code>worldmet</code> package</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sec-windRose.html"><a href="sec-windRose.html"><i class="fa fa-check"></i><b>5</b> Wind and Pollution Roses</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sec-windRose.html"><a href="sec-windRose.html#example-of-use"><i class="fa fa-check"></i><b>5.1</b> Example of use</a></li>
<li class="chapter" data-level="5.2" data-path="sec-windRose.html"><a href="sec-windRose.html#sec:comp-met"><i class="fa fa-check"></i><b>5.2</b> Comparing two meteorological data sets</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sec-percentileRose.html"><a href="sec-percentileRose.html"><i class="fa fa-check"></i><b>6</b> Percentile roses</a>
<ul>
<li class="chapter" data-level="6.1" data-path="sec-percentileRose.html"><a href="sec-percentileRose.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="sec-percentileRose.html"><a href="sec-percentileRose.html#examples"><i class="fa fa-check"></i><b>6.2</b> Examples</a></li>
<li class="chapter" data-level="6.3" data-path="sec-percentileRose.html"><a href="sec-percentileRose.html#sec:CPF"><i class="fa fa-check"></i><b>6.3</b> Condtional probability function</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html"><i class="fa fa-check"></i><b>7</b> Polar plots</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#introduction-to-polar-plots"><i class="fa fa-check"></i><b>7.1</b> Introduction to polar plots</a></li>
<li class="chapter" data-level="7.2" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#polar-plot-examples"><i class="fa fa-check"></i><b>7.2</b> Examples</a></li>
<li class="chapter" data-level="7.3" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#nonparametric-wind-regression-nwr"><i class="fa fa-check"></i><b>7.3</b> Nonparametric Wind Regression, NWR</a></li>
<li class="chapter" data-level="7.4" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#conditional-probability-function-cpf-plot"><i class="fa fa-check"></i><b>7.4</b> Conditional Probability Function (CPF) plot</a></li>
<li class="chapter" data-level="7.5" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#pairwise-statistics"><i class="fa fa-check"></i><b>7.5</b> Pairwise statistics</a></li>
<li class="chapter" data-level="7.6" data-path="sec-polarPlot.html"><a href="sec-polarPlot.html#sec:polarCluster"><i class="fa fa-check"></i><b>7.6</b> Clustering</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sec-timeVariation.html"><a href="sec-timeVariation.html"><i class="fa fa-check"></i><b>8</b> Temporal variations</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sec-timeVariation.html"><a href="sec-timeVariation.html#sec:purpose-time-var"><i class="fa fa-check"></i><b>8.1</b> Purpose</a></li>
<li class="chapter" data-level="8.2" data-path="sec-timeVariation.html"><a href="sec-timeVariation.html#applications"><i class="fa fa-check"></i><b>8.2</b> Applications</a></li>
<li class="chapter" data-level="8.3" data-path="sec-timeVariation.html"><a href="sec-timeVariation.html#output"><i class="fa fa-check"></i><b>8.3</b> Output</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="sec-timeProp.html"><a href="sec-timeProp.html"><i class="fa fa-check"></i><b>9</b> Time proportion plots</a>
<ul>
<li class="chapter" data-level="9.1" data-path="sec-timeProp.html"><a href="sec-timeProp.html#sec:timePropBack"><i class="fa fa-check"></i><b>9.1</b> Background</a></li>
<li class="chapter" data-level="9.2" data-path="sec-timeProp.html"><a href="sec-timeProp.html#sec:timePropEx"><i class="fa fa-check"></i><b>9.2</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="sec-calendarPlot.html"><a href="sec-calendarPlot.html"><i class="fa fa-check"></i><b>10</b> Calendar plots</a>
<ul>
<li class="chapter" data-level="10.1" data-path="sec-calendarPlot.html"><a href="sec-calendarPlot.html#purpose"><i class="fa fa-check"></i><b>10.1</b> Purpose</a></li>
<li class="chapter" data-level="10.2" data-path="sec-calendarPlot.html"><a href="sec-calendarPlot.html#calendar-examples"><i class="fa fa-check"></i><b>10.2</b> Calendar examples</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="sec-TheilSen.html"><a href="sec-TheilSen.html"><i class="fa fa-check"></i><b>11</b> Theil-Sen trends</a>
<ul>
<li class="chapter" data-level="11.1" data-path="sec-TheilSen.html"><a href="sec-TheilSen.html#trend-estimates"><i class="fa fa-check"></i><b>11.1</b> Trend estimates</a></li>
<li class="chapter" data-level="11.2" data-path="sec-TheilSen.html"><a href="sec-TheilSen.html#example-trend-analysis"><i class="fa fa-check"></i><b>11.2</b> Example trend analysis</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="sec-timeVariation.html"><a href="sec-timeVariation.html#output"><i class="fa fa-check"></i><b>11.2.1</b> Output</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">openair</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec:polarPlot" class="section level1" number="7">
<h1><span class="header-section-number">Section 7</span> Polar plots</h1>
<p>This Sections considers the flexible <code>polarPlot</code> function that is used to provide information about source characteritics. The clustering of polar plots is also considered using <code>polarCluster</code>.</p>
<div id="introduction-to-polar-plots" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Introduction to polar plots</h2>
<p>The <code>polarPlot</code> function plots a <em>bivariate polar plot</em> of
concentrations. Concentrations are shown to vary by wind speed and
wind direction. In many respects they are similar to the plots shown
in Section <a href="#sec:polarFreq"><strong>??</strong></a> but include some additional
enhancements. These enhancements include: plots are shown as a
continuous surface and surfaces are calculated through modelling using
smoothing techniques. These plots are not entirely new as others have
considered the joint wind speed-direction dependence of concentrations
(see for example <span class="citation">Yu et al. (<a href="#ref-Yu2004" role="doc-biblioref">2004</a>)</span>). However, plotting the data in
polar coordinates and for the purposes of source identification is
new. Furthermore, the basic polar plot is since been enhanced in many
ways as described below. Publications that describe or use the
technique are <span class="citation">Carslaw et al. (<a href="#ref-Carslaw2006a" role="doc-biblioref">2006</a>)</span> and
<span class="citation">Westmoreland et al. (<a href="#ref-Westmoreland2007" role="doc-biblioref">2007</a>)</span>. These plots have proved to be useful for
quickly gaining a graphical impression of potential sources influences
at a location.</p>
<p>The <code>polarPlot</code> function is described in more detail in
<span class="citation">Carslaw et al. (<a href="#ref-Carslaw2006a" role="doc-biblioref">2006</a>)</span> where it is used to triangulate sources in an
airport setting, <span class="citation">Carslaw and Beevers (<a href="#ref-CarslawClust2013" role="doc-biblioref">2013</a>)</span> where it is used with a
clustering technique to identify features in a polar plot with
similar characteristics and <span class="citation">Uria-Tellaetxe and Carslaw (<a href="#ref-Uria2014" role="doc-biblioref">2014</a>)</span> where it is extended
to include a conditional probability function to extract more
information from the plots.</p>
<p>For many, maybe most situations, increasing wind speed generally
results in lower concentrations due to increased dilution through
advection and increased mechanical turbulence. There are, however,
many processes that can lead to interesting concentration-wind speed
dependencies, and we will provide a more theoretical treatment of this
in due course. However, below are a few reasons why concentrations can
change with increasing wind speeds.</p>
<ul>
<li><p>Buoyant plumes from tall stacks can be brought down to
ground-level resulting in high concentrations under high wind speed
conditions.</p></li>
<li><p>Particle suspension increases with increasing wind speeds
e.g. PM<sub>10</sub> from spoil heaps and the like.</p></li>
<li><p>‘Particle’ suspension can be important close to coastal areas
where higher wind speeds generate more sea spray.</p></li>
<li><p>The wind speed dependence of concentrations in a street canyon
can be very complex: higher wind speeds do not always results in
lower concentrations due to re-circulation. Bivariate polar plots are
very good at revealing these complexities.</p></li>
<li><p>As <span class="citation">Carslaw et al. (<a href="#ref-Carslaw2006a" role="doc-biblioref">2006</a>)</span> showed, aircraft emissions have an unusual
wind speed dependence and this can help distinguish them from other
sources. If several measurement sites are available, polar plots can
be used to triangulate different sources.</p></li>
<li><p>Concentrations of NO<sub>2</sub> can increase with increasing wind speed
— or at least not decline steeply due to increased mixing. This
mixing can result in O<sub>3</sub>-rich air converting NO to NO<sub>2</sub>.</p></li>
</ul>
<p>The function has been developed to allow variables other than wind
speed to be plotted with wind direction in polar coordinates. The key
issue is that the other variable plotted against wind direction should
be discriminating in some way. For example, temperature can help
reveal high-level sources brought down to ground level in unstable
atmospheric conditions, or show the effect a source emission dependent
on temperature e.g. biogenic isoprene. For research applications where
many more variables could be available, discriminating sources by
these other variables could be very insightful.</p>
<p>Bivariate polar plots are constructed in the following way. First,
wind speed, wind direction and concentration data are partitioned into
wind speed-direction bins and the mean concentration calculated for
each bin. Testing on a wide range of data suggests that wind direction
intervals at 5–10<span class="math inline">\(^\circ\)</span> and 40 wind speed intervals capture sufficient
detail of the concentration distribution. The wind direction data
typically available are generally rounded to 10<span class="math inline">\(^\circ\)</span> and for
typical surface measurements. Binning the
data in this way is not strictly necessary but acts as an effective
data reduction technique without affecting the fidelity of the plot
itself. Furthermore, because of the inherent wind direction
variability in the atmosphere, data from several weeks, months or
years typically used to construct a bivariate polar plot tends to be
diffuse and does not vary abruptly with either wind direction or speed
and more finely resolved bin sizes or working with the raw data
directly does not yield more information.</p>
<p>The wind components, <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> are calculated i.e.</p>
<p><span class="math display" id="eq:wind-comp">\[\begin{equation}
u = \overline{u} . sin\left(\frac{2\pi}{\theta}\right), v = \overline{u} . cos\left(\frac{2\pi}{\theta}\right) \tag{7.1}
\end{equation}\]</span></p>
<p>with <span class="math inline">\(\overline{u}\)</span> is the mean hourly wind speed and <span class="math inline">\(\theta\)</span> is the mean wind
direction in degrees with 90<span class="math inline">\(^\circ\)</span> as being from the east.</p>
<p>The calculations above provides a <span class="math inline">\(u\)</span>, <span class="math inline">\(v\)</span>, concentration (<span class="math inline">\(C\)</span>)
surface. While it would be possible to work with this surface data
directly a better approach is to apply a model to the surface to
describe the concentration as a function of the wind components <span class="math inline">\(u\)</span>
and <span class="math inline">\(v\)</span> to extract real source features rather than noise. A flexible
framework for fitting a surface is to use a Generalized Additive Model
(GAM) e.g. <span class="citation">Hastie and Tibshirani (<a href="#ref-Hastie1990" role="doc-biblioref">1990</a>)</span>, <span class="citation">Wood (<a href="#ref-Wood2006" role="doc-biblioref">2006</a>)</span>. GAMs are a useful modelling
framework with respect to air pollution prediction because typically
the relationships between variables are non-linear and variable
interactions are important, both of which issues can be addressed in a
GAM framework. GAMs can be expressed as shown in Equation <a href="sec-polarPlot.html#eq:gam">(7.2)</a>:</p>
<p><span class="math display" id="eq:gam">\[\begin{equation}
  \sqrt{C_i} = \beta_0 + \sum_{j=1}^{n}s_j(x_{ij}) + e_i \tag{7.2}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(C_i\)</span> is the ith pollutant concentration, <span class="math inline">\(\beta_0\)</span> is the
overall mean of the response, <span class="math inline">\(s_j(x_{ij})\)</span> is the smooth function of
ith value of covariate <span class="math inline">\(j\)</span>, <span class="math inline">\(n\)</span> is the total number of covariates, and
<span class="math inline">\(e_i\)</span> is the <span class="math inline">\(i\)</span>th residual. Note that <span class="math inline">\(C_i\)</span> is square-root
transformed as the transformation generally produces better model
diagnostics e.g. normally distributed residuals.</p>
<p>The model chosen for the estimate of the concentration surface is
given by @ref(eq:mod}. In this model the square root-transformed
concentration is a smooth function of the bivariate wind components
<span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span>. Note that the smooth function used is <em>isotropic</em>
because <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> are on the same scales. The isotropic smooth
avoids the potential difficulty of smoothing two variables on
different scales e.g. wind speed and direction, which introduces
further complexities.</p>
<p><span class="math display" id="eq:gam-2">\[\begin{equation}
  \sqrt{C_i} = s(u, v) + e_i \tag{7.3}
\end{equation}\]</span></p>
</div>
<div id="polar-plot-examples" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Examples</h2>
<p>We first use the function in its simplest form to make a polar plot of
NO<sub>x</sub>. The code is very simple as shown in Figure <a href="sec-polarPlot.html#fig:polarPlot">7.1</a>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="sec-polarPlot.html#cb39-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;nox&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarPlot"></span>
<img src="openair_files/figure-html/polarPlot-1.png" alt="Default use of the `polarPlot` function applied to Marylebone Road NO~x~ concentrations." width="50%" />
<p class="caption">
Figure 7.1: Default use of the <code>polarPlot</code> function applied to Marylebone Road NO<sub>x</sub> concentrations.
</p>
</div>
<p>This produces Figure <a href="sec-polarPlot.html#fig:polarPlot">7.1</a>. The scale is automatically set
using whatever units the original data are in. This plot clearly shows
highest NO<sub>x</sub> concentrations when the wind is from the
south-west. Given that the monitor is on the <em>south</em> side of the
street and the highest concentrations are recorded when the wind is
blowing <em>away</em> from the monitor is strong evidence of street
canyon recirculation.</p>
<p>Figure <a href="sec-polarPlot.html#fig:polarPlot2">7.2</a> and Figure <a href="sec-polarPlot.html#fig:polarPlot3">7.3</a> shows polar
plots using different defaults and for other pollutants. In the first
(Figure <a href="sec-polarPlot.html#fig:polarPlot2">7.2</a>, a different colour scheme is used and some
adjustments are made to the key. In Figure <a href="sec-polarPlot.html#fig:polarPlot3">7.3</a>, SO<sub>2</sub>
concentrations are shown. What is interesting about this plot compared
with either Figure <a href="sec-polarPlot.html#fig:polarPlot2">7.2</a> or Figure <a href="sec-polarPlot.html#fig:polarPlot">7.1</a> is that the concentration pattern is very different i.e. high
concentrations with high wind speeds from the east. The most likely
source of this SO<sub>2</sub> are industrial sources to the east of
London. The plot does still however show evidence of a source to the
south-west, similar to the plot for NO<sub>x</sub>, which implies that road
traffic sources of SO<sub>2</sub> can also be detected.</p>
<p>These plots often show interesting features at higher wind speeds. For
these conditions there can be very few measurements and therefore
greater uncertainty in the calculation of the surface. There are
several ways in which this issue can be tackled. First, it is possible
to avoid smoothing altogether and use <code>polarFreq</code>. The problem
with this approach is that it is difficult to know how best to bin
wind speed and direction: the choice of interval tends to be
arbitrary. Second, the effect of setting a minimum number of
measurements in each wind speed-direction bin can be examined through
<code>min.bin</code>. It is possible that a single point at high wind speed
conditions can strongly affect the surface prediction. Therefore,
setting <code>min.bin = 3</code>, for example, will remove all wind
speed-direction bins with fewer than 3 measurements <em>before</em>
fitting the surface. This is a useful strategy for testing how
sensitive the plotted surface is to the number of measurements
available. While this is a useful strategy to get a feel for how the
surface changes with different <code>min.bin</code> settings, it is still
difficult to know how many points should be used as a minimum. Third,
consider setting <code>uncertainty = TRUE</code>. This option will show the
predicted surface together with upper and lower 95% confidence
intervals, which take account of the frequency of measurements. The
uncertainty approach ought to be the most robust and removes any
arbitrary setting of other options. There is a close relationship
between the amount of smoothing and the uncertainty: more smoothing
will tend to reveal less detail and lower uncertainties in the fitted
surface and vice-versa.</p>
<p>The default however is to down-weight the bins with few data points
when fitting a surface. Weights of 0.25, 0.5 and 0.75 are used for
bins containing 1, 2 and 3 data points respectively. The advantage of
this approach is that no data are actually removed (which is what
happens when using <code>min.bin</code>). This approach should be robust in a
very wide range of situations and is also similar to the approaches
used when trying to locate sources when using back trajectories as
described in Section <a href="#sec:trajPlot"><strong>??</strong></a>. Users can ignore the automatic
weighting by supplying the option <code>weights = c(1, 1, 1)</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="sec-polarPlot.html#cb40-1" aria-hidden="true"></a><span class="co">## NOx plot</span></span>
<span id="cb40-2"><a href="sec-polarPlot.html#cb40-2" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;nox&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;jet&quot;</span>, </span>
<span id="cb40-3"><a href="sec-polarPlot.html#cb40-3" aria-hidden="true"></a>          <span class="dt">key.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb40-4"><a href="sec-polarPlot.html#cb40-4" aria-hidden="true"></a>          <span class="dt">key.header =</span> <span class="st">&quot;mean nox (ug/m3)&quot;</span>, </span>
<span id="cb40-5"><a href="sec-polarPlot.html#cb40-5" aria-hidden="true"></a>          <span class="dt">key.footer =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarPlot2"></span>
<img src="openair_files/figure-html/polarPlot2-1.png" alt="Example plots using the `polarPlot` function with different options for the mean concentration of NO~x~." width="50%" />
<p class="caption">
Figure 7.2: Example plots using the <code>polarPlot</code> function with different options for the mean concentration of NO<sub>x</sub>.
</p>
</div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="sec-polarPlot.html#cb41-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarPlot3"></span>
<img src="openair_files/figure-html/polarPlot3-1.png" alt="Example plots using the `polarPlot` function for the mean concentration of SO~2~." width="50%" />
<p class="caption">
Figure 7.3: Example plots using the <code>polarPlot</code> function for the mean concentration of SO<sub>2</sub>.
</p>
</div>
<p>A very useful approach for understanding air pollution is to consider
ratios of pollutants. One reason is that pollutant ratios can be
largely independent of meteorological variation. In many circumstances
it is possible to gain a lot of insight into sources if pollutant
ratios are considered. First, it is necessary to calculate a ratio,
which is easy in R. In this example we consider the ratio of SO<sub>2</sub>/NO<sub>x</sub>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="sec-polarPlot.html#cb42-1" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb42-2"><a href="sec-polarPlot.html#cb42-2" aria-hidden="true"></a>mydata &lt;-<span class="st"> </span><span class="kw">mutate</span>(mydata, <span class="dt">ratio =</span> so2 <span class="op">/</span><span class="st"> </span>nox)</span></code></pre></div>
<p>This makes a new variable called <code>ratio</code>. Sometimes it can be
problematic if there are values equal to zero on the denominator, as
is the case here. The mean and maximum value of the ratio is infinite,
as shown by the <code>Inf</code> in the statistics below. Luckily, R can deal
with infinity and the <span class="pkg">openair</span> functions will remove these values
before performing calculations. It is very simple therefore to
calculate ratios.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="sec-polarPlot.html#cb43-1" aria-hidden="true"></a><span class="kw">summary</span>(mydata<span class="op">$</span>ratio)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   0.000   0.018   0.024     Inf   0.034     Inf   11782</code></pre>
<p>A polar plot of the SO<sub>2</sub>/NO<sub>x</sub> ratio is shown in Figure
<a href="sec-polarPlot.html#fig:polarRatio">7.4</a>. The plot highlights some new features not
seen before. First, to the north there seems to be evidence that the
air tends to have a higher SO<sub>2</sub>/NO<sub>x</sub> ratio. Also, the source to the
east has a higher SO<sub>2</sub>/NO<sub>x</sub> ratio compared with that when the wind
is from the south-west i.e. dominated by road sources. It seems
therefore that the easterly source(s), which are believed to be
industrial sources have a different SO<sub>2</sub>/NO<sub>x</sub> ratio compared with
road sources. This is a very simple analysis, but ratios can be used
effectively in many functions and are particularly useful in the
presence of high source complexity.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="sec-polarPlot.html#cb45-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;ratio&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;so2/nox ratio&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarRatio"></span>
<img src="openair_files/figure-html/polarRatio-1.png" alt="Bivariate polar plot of the ratio of SO~2~/NO~x~." width="50%" />
<p class="caption">
Figure 7.4: Bivariate polar plot of the ratio of SO<sub>2</sub>/NO<sub>x</sub>.
</p>
</div>
<p>Sometimes when considering ratios it might be necessary to limit the
values in some way; perhaps due to some unusually low value
denominator data resulting in a few very high values for the
ratio. This is easy to do with the <strong>dplyr</strong> <code>filter</code> command. The code below selects ratios less than 0.1.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="sec-polarPlot.html#cb46-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(<span class="kw">filter</span>(mydata, ratio <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>), <span class="dt">pollutant =</span> <span class="st">&quot;ratio&quot;</span>)</span></code></pre></div>
<p>The uncertainties in the surface can be calculated by setting the
option <code>uncertainty = TRUE</code>. The details are described above and
here we show the example of SO<sub>2</sub> concentrations
(Figure <a href="sec-polarPlot.html#fig:polarUncer">7.5</a>. In general the uncertainties are higher
at high wind speeds i.e. at the ‘fringes’ of a plot where there are
fewer data. However, the magnitude depends on both the frequency and
magnitude of the concentration close to the points of interest. The
pattern of uncertainty is not always obvious and it can differ
markedly for different pollutants.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="sec-polarPlot.html#cb47-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">uncertainty =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarUncer"></span>
<img src="openair_files/figure-html/polarUncer-1.png" alt="Bivariate polar plot of SO~2~ concentrations at Marylebone Road. Three surfaces are shown: the central prediction (middle) and the lower and upper 95% estimated uncertainties. These plots help to show that in this particular case, some of the concentrations for strong easterly and south-easterly winds are rather uncertain. However, the central feature to the east remains, suggesting this feature is real and not an artifact of there being too few data." width="768" />
<p class="caption">
Figure 7.5: Bivariate polar plot of SO<sub>2</sub> concentrations at Marylebone Road. Three surfaces are shown: the central prediction (middle) and the lower and upper 95% estimated uncertainties. These plots help to show that in this particular case, some of the concentrations for strong easterly and south-easterly winds are rather uncertain. However, the central feature to the east remains, suggesting this feature is real and not an artifact of there being too few data.
</p>
</div>
<p>The <code>polarPlot</code> function can also produce plots dependent on
another variable (see the <code>type</code> option). For example, the
variation of SO<sub>2</sub> concentrations at Marylebone Road by hour of the
day in the code below. The function was called as shown in below, and
in this case the minimum number of points in each wind speed/direction
was set to 2.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="sec-polarPlot.html#cb48-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;hour&quot;</span>, <span class="dt">min.bin =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>This plot shows that concentrations of SO<sub>2</sub> tend to be highest from
the east (as also shown in Figure <a href="sec-polarPlot.html#fig:polarPlot3">7.3</a>) and for hours in
the morning. Together these plots can help better understand different
source types. For example, does a source only seem to be present
during weekdays, or winter months etc. In the case of <code>type = "hour"</code>, the more obvious presence during the morning hours could be
due to meteorological factors and this possibility should be
investigated as well. In other settings where there are many sources
that vary in their source emission and temporal characteristics, the
<code>polarPlot</code> function should prove to be very useful.</p>
<p>One issue to be aware of is the amount of data required to generate
some of these plots; particularly the hourly plots. If only a
relatively short time series is available there may not be sufficient
information to produce useful plots. Whether this is important or not
will depend on the specific circumstances e.g. the prevalence of wind
speeds and directions from the direction of interest. When used to
produce many plots (e.g. <code>type = "hour"</code>), the run time can be quite
long.</p>
</div>
<div id="nonparametric-wind-regression-nwr" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Nonparametric Wind Regression, NWR</h2>
<p>An alternative approach to modelling the surface concentrations with a
GAM is to use kernel smoothers, as described by
<span class="citation">Henry et al. (<a href="#ref-henry2009" role="doc-biblioref">2009</a>)</span>. In NWR, smoothing is achieved using
nonparametric kernel smoothers that weight concentrations on a surface
according to their proximity to defined wind speed and direction
intervals. In the approach adopted in <span class="pkg">openair</span> (which is not identical
to <span class="citation">Henry et al. (<a href="#ref-henry2009" role="doc-biblioref">2009</a>)</span>), Gaussian smoothers are used for both wind
direction and wind speed. Unlike the default GAM approach in <span class="pkg">openair</span>,
the NWR technique works directly with the raw (often hourly) data. It
tends to provide similar results to <span class="pkg">openair</span> but may have advantages
in certain situations e.g. when there is insufficient data available
to use a GAM. The width of the Gaussian kernels (<span class="math inline">\(\sigma\)</span>) is
controlled by the options <code>wd_spread</code> and <code>ws_spread</code>.</p>
<p>An example for SO<sub>2</sub> concentrations is shown in Figure
<a href="sec-polarPlot.html#fig:polarNWR">7.6</a>, which can be compared with Figure <a href="sec-polarPlot.html#fig:polarPlot3">7.3</a>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="sec-polarPlot.html#cb49-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">statistic =</span> <span class="st">&quot;nwr&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarNWR"></span>
<img src="openair_files/figure-html/polarNWR-1.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the NWR approach." width="50%" />
<p class="caption">
Figure 7.6: <code>polarPlot</code> of SO<sub>2</sub> concentrations at Marylebone Road based on the NWR approach.
</p>
</div>
</div>
<div id="conditional-probability-function-cpf-plot" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Conditional Probability Function (CPF) plot</h2>
<p>The conditional probability functions (CPF) was described on
 in the context of the <code>percentileRose</code>
function. The CPF was originally used to show the wind directions that
dominate a (specified) high concentration of a pollutant; showing the
probability of such concentrations occurring by wind direction
<span class="citation">Ashbaugh, Malm, and Sadeh (<a href="#ref-Ashbaugh1985" role="doc-biblioref">1985</a>)</span>. However, these ideas can very usefully be
applied to bivariate polar plots. In this case the CPF is defined as
CPF = <span class="math inline">\(m_{\theta,j}/n_{\theta,j}\)</span>, where <span class="math inline">\(m_{\theta,j}\)</span> is the number
of samples in the wind sector <span class="math inline">\(\theta\)</span> and wind speed interval <span class="math inline">\(j\)</span>
with mixing ratios greater than some ‘high’ concentration, and
<span class="math inline">\(n_{\theta, j}\)</span> is the total number of samples in the same wind
direction-speed interval. Note that <span class="math inline">\(j\)</span> does not have to be wind speed
but could be any numeric variable e.g. ambient temperature. CPF
analysis is very useful for showing which wind direction, wind speed
intervals are dominated by high concentrations and give the
probability of doing so. A full explanation of the development and use
of the bivariate case of the CPF is described in <span class="citation">Uria-Tellaetxe and Carslaw (<a href="#ref-Uria2014" role="doc-biblioref">2014</a>)</span>
where it is applied to monitoring data close to steelworks.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="sec-polarPlot.html#cb50-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, </span>
<span id="cb50-2"><a href="sec-polarPlot.html#cb50-2" aria-hidden="true"></a>          <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>, </span>
<span id="cb50-3"><a href="sec-polarPlot.html#cb50-3" aria-hidden="true"></a>          <span class="dt">statistic =</span> <span class="st">&quot;cpf&quot;</span>, </span>
<span id="cb50-4"><a href="sec-polarPlot.html#cb50-4" aria-hidden="true"></a>          <span class="dt">percentile =</span> <span class="dv">90</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarPlotCPF"></span>
<img src="openair_files/figure-html/polarPlotCPF-1.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function." width="50%" />
<p class="caption">
Figure 7.7: <code>polarPlot</code> of SO<sub>2</sub> concentrations at Marylebone Road based on the CPF function.
</p>
</div>
<p>An example of a CPF polar plot is shown in Figure <a href="sec-polarPlot.html#fig:polarPlotCPF">7.7</a>
for the 90th percentile concentration of SO<sub>2</sub>. This plot shows that
for most wind speed-directions the probability of SO<sub>2</sub>
concentrations being greater than the 90th percentile is zero. The
clearest areas where the probability is higher is to the east. Indeed,
the plot now clearly reveals two potential sources of SO<sub>2</sub>, which
are not as apparent in the ‘standard’ plot shown in Figure
<a href="sec-polarPlot.html#fig:polarPlot3">7.3</a>. Note that Figure <a href="sec-polarPlot.html#fig:polarPlotCPF">7.7</a> also
gives the calculated percentile at the bottom of the plot (9.2 ppb in
this case). Figure <a href="sec-polarPlot.html#fig:polarPlotCPF">7.7</a> can also be compared with the
CPF plot based only on wind direction shown in Figure
<a href="sec-percentileRose.html#fig:percentileRoseCPF">6.4</a>. While Figure <a href="sec-percentileRose.html#fig:percentileRoseCPF">6.4</a>
very clearly shows that easterly wind dominate high concentrations of
SO<sub>2</sub>, Figure <a href="sec-polarPlot.html#fig:polarPlotCPF">7.7</a> provides additional valuable
information by also considering wind speed, which in this case is able
to discriminate between two sources (or groups of sources) to the east.</p>
<p>The polar CPF plot is therefore potentially very useful for source
identification and characterisation. It is, for example, worth also
considering other percentile levels and other pollutants. For example,
considering the 95th percentile for SO<sub>2</sub> ‘removes’ one of the
sources (the one at highest wind speed). This helps to show some maybe
important differences between the sources that could easily have been
missed. Similarly, considering other pollutants can help build up a
good understanding of these sources. A CPF plot for NO<sub>2</sub> at the 90th
percentile shows the single dominance of the road source. However, a
CPF plot at the 75th percentile level indicates source contributions
from the east (likely tall stacks), which again are not as clear in
the standard bivariate polar plot. Considering a range of percentile
values can therefore help to build up a more complete understanding of
source contributions.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="sec-polarPlot.html#cb51-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb51-2"><a href="sec-polarPlot.html#cb51-2" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>))</span>
<span id="cb51-3"><a href="sec-polarPlot.html#cb51-3" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">30</span>))</span>
<span id="cb51-4"><a href="sec-polarPlot.html#cb51-4" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">30</span>, <span class="dv">40</span>))</span>
<span id="cb51-5"><a href="sec-polarPlot.html#cb51-5" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">40</span>, <span class="dv">50</span>))</span>
<span id="cb51-6"><a href="sec-polarPlot.html#cb51-6" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">60</span>))</span>
<span id="cb51-7"><a href="sec-polarPlot.html#cb51-7" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">60</span>, <span class="dv">70</span>))</span>
<span id="cb51-8"><a href="sec-polarPlot.html#cb51-8" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">70</span>, <span class="dv">80</span>))</span>
<span id="cb51-9"><a href="sec-polarPlot.html#cb51-9" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">80</span>, <span class="dv">90</span>))</span>
<span id="cb51-10"><a href="sec-polarPlot.html#cb51-10" aria-hidden="true"></a><span class="kw">polarPlot</span>(mydata, <span class="dt">poll =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">stati =</span> <span class="st">&quot;cpf&quot;</span>, <span class="dt">percentile =</span> <span class="kw">c</span>(<span class="dv">90</span>, <span class="dv">100</span>))</span></code></pre></div>
<div class="figure"><span id="fig:polarPlotCPFInt"></span>
<img src="openair_files/figure-html/polarPlotCPFInt-1.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" /><img src="openair_files/figure-html/polarPlotCPFInt-2.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" /><img src="openair_files/figure-html/polarPlotCPFInt-3.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" /><img src="openair_files/figure-html/polarPlotCPFInt-4.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" /><img src="openair_files/figure-html/polarPlotCPFInt-5.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" /><img src="openair_files/figure-html/polarPlotCPFInt-6.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" /><img src="openair_files/figure-html/polarPlotCPFInt-7.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" /><img src="openair_files/figure-html/polarPlotCPFInt-8.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" /><img src="openair_files/figure-html/polarPlotCPFInt-9.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" /><img src="openair_files/figure-html/polarPlotCPFInt-10.png" alt="`polarPlot` of SO~2~ concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0--10, 10--20, ... , 90--100." width="33%" />
<p class="caption">
Figure 7.8: <code>polarPlot</code> of SO<sub>2</sub> concentrations at Marylebone Road based on the CPF function for a range of percentile intervals from 0–10, 10–20, … , 90–100.
</p>
</div>
<p>However, even more useful information can be gained by considering
<em>intervals</em> of percentiles e.g. 50–60, 60–70 etc. By
considering intervals of percentiles it becomes clear that some
sources only affect a limited percentile range. <code>polarPlot</code> can
accept a <code>percentile</code> argument of length two e.g. <code>percentile =  c(80, 90)</code>. In this case concentrations in the range from the lower
to upper percentiles will be considered. In Figure
<a href="sec-polarPlot.html#fig:polarPlotCPFInt">7.8</a> for example, it is apparent that the
road source to the south west is only important between the 60 to 90th
percentiles. As mentioned previously, the chimney stacks to the east
are important for the higher percentiles (90 to 100). What is
interesting though is the emergence of what appears to be other
sources at the lower percentile intervals. These potential sources are
not apparent in Figure <a href="sec-polarPlot.html#fig:polarPlot3">7.3</a>. The other interesting aspect
is that it does seem that specific sources tend to be prominent for
specific percentile ranges. If this characteristic is shown to be the
case more generally, then CPF intervals could be a powerful way in
which to identify many sources. Whether these particular sources are
important or not is questionable and depends on the aims of the
analysis. However, there is no reason to believe that the potential
sources shown in the percentile ranges 0 to 50 are artefacts. They
could for example be signals from more distant point sources whose
plumes have diluted more over longer distances. Such sources would be
‘washed out’ in an ordinary polar plot. For a fuller example of this
approach see <span class="citation">Uria-Tellaetxe and Carslaw (<a href="#ref-Uria2014" role="doc-biblioref">2014</a>)</span>.</p>
<p>Note that it is easy to work out what the concentration intervals are
for the percentiles shown in Figure <a href="sec-polarPlot.html#fig:polarPlotCPFInt">7.8</a>:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="sec-polarPlot.html#cb52-1" aria-hidden="true"></a><span class="kw">quantile</span>(mydata<span class="op">$</span>so2, <span class="dt">probs =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">0.1</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##      0%     10%     20%     30%     40%     50%     60%     70%     80%     90% 
##  0.0000  1.0125  1.8825  2.5000  3.2500  4.0000  4.9375  5.9100  7.2375  9.2500 
##    100% 
## 63.2050</code></pre>
<p>To plot the Figures on one page it is necessary to make the plot
objects first and then decide how to plot them. To plot the Figures in
a particular layout see <a href="#sec:multiple-plots-page"><strong>??</strong></a>.</p>
</div>
<div id="pairwise-statistics" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Pairwise statistics</h2>
<p><span class="citation">Grange, Lewis, and Carslaw (<a href="#ref-grange2016" role="doc-biblioref">2016</a>)</span> further developed the capabilities of the <code>polarPlot</code> function by allowing pairwise statistics to be used. This method makes it possible to consider the relationship between two pollutants to be considered. The relationship between two pollutants often yields useful source apportionment information and when combined with the <code>polarPlot</code> function can provide enhanced information. The pairwise statistics that can be considered include:</p>
<ul>
<li><p>The Pearson or Spearman correlation coefficient, <span class="math inline">\(r\)</span>;</p></li>
<li><p>The robust slope (gradient) resulting from a linear regressions
between two pollutants.</p></li>
<li><p>The quantile slope from a quantile regression applied to two
variables with a quantile value of <span class="math inline">\(tau\)</span>. By default, the median
slope (i.e. <span class="math inline">\(tau\)</span> = 0.5) is used by the actual level can be set by
the user.</p></li>
</ul>
<p>The calculation involves a weighted Pearson correlation coefficient,
which is weighted by Gaussian kernels for wind direction and the radial
variable (by default wind speed). More weight is assigned to values
close to a wind speed-direction interval. Kernel weighting is used to
ensure that all data are used rather than relying on the potentially
small number of values in a wind speed-direction interval.</p>
<p>The calculation involves a weighted statistics by Gaussian kernels for
wind direction and the radial variable (by default wind speed). More
weight is assigned to values close to a wind speed-direction
interval. Kernel weighting is used to ensure that all data are used
rather than relying on the potentially small number of values in a
wind speed-direction interval.</p>
<p>An example usage scenario is that measurements of metal concentrations
are made close to a steelworks where there is interest in
understanding the principal sources. While it is useful to consider
the correlation between potentially many metal concentrations, the
contention is that if the correlation is also considered as a function
of wind speed and direction, improved information will be available of
the types of sources contributing. For example, it may be that Fe and
Mn are quite strongly correlated overall, but they tend to be most
correlated under specific wind speed and direction ranges —
suggesting a specific source origin.</p>
<p>As an example of usage we will consider the relationship between
PM<sub>2.5</sub> and PM<sub>10</sub> at the rural Harwell site in
Oxfordshire. Additionally, we will use meteorological data from a
nearby site rather than rely on modelled values that are provided in
<code>importAURN</code>.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="sec-polarPlot.html#cb54-1" aria-hidden="true"></a><span class="kw">library</span>(worldmet) <span class="co"># to access met data</span></span>
<span id="cb54-2"><a href="sec-polarPlot.html#cb54-2" aria-hidden="true"></a><span class="kw">library</span>(tidyverse) </span>
<span id="cb54-3"><a href="sec-polarPlot.html#cb54-3" aria-hidden="true"></a></span>
<span id="cb54-4"><a href="sec-polarPlot.html#cb54-4" aria-hidden="true"></a>har &lt;-<span class="st"> </span><span class="kw">importAURN</span>(<span class="st">&quot;har&quot;</span>, <span class="dt">year =</span> <span class="dv">2013</span>)</span>
<span id="cb54-5"><a href="sec-polarPlot.html#cb54-5" aria-hidden="true"></a></span>
<span id="cb54-6"><a href="sec-polarPlot.html#cb54-6" aria-hidden="true"></a><span class="co"># import met data from nearby site (Benson)</span></span>
<span id="cb54-7"><a href="sec-polarPlot.html#cb54-7" aria-hidden="true"></a>met &lt;-<span class="st"> </span><span class="kw">importNOAA</span>(<span class="dt">code =</span> <span class="st">&quot;036580-99999&quot;</span>, <span class="dt">year =</span> <span class="dv">2013</span>)</span>
<span id="cb54-8"><a href="sec-polarPlot.html#cb54-8" aria-hidden="true"></a></span>
<span id="cb54-9"><a href="sec-polarPlot.html#cb54-9" aria-hidden="true"></a><span class="co"># merge AQ and met but don&#39;t use modelled ws and wd</span></span>
<span id="cb54-10"><a href="sec-polarPlot.html#cb54-10" aria-hidden="true"></a>har &lt;-<span class="st"> </span><span class="kw">inner_join</span>(</span>
<span id="cb54-11"><a href="sec-polarPlot.html#cb54-11" aria-hidden="true"></a>  <span class="kw">select</span>(har, <span class="op">-</span>ws, <span class="op">-</span>wd, <span class="op">-</span>air_temp),</span>
<span id="cb54-12"><a href="sec-polarPlot.html#cb54-12" aria-hidden="true"></a>  met,</span>
<span id="cb54-13"><a href="sec-polarPlot.html#cb54-13" aria-hidden="true"></a>  <span class="dt">by =</span> <span class="st">&quot;date&quot;</span></span>
<span id="cb54-14"><a href="sec-polarPlot.html#cb54-14" aria-hidden="true"></a>)</span></code></pre></div>
<p>An example pairwise regression surface relationship relating PM<sub>2.5</sub>
and PM<sub>10</sub> is shown in Figure <a href="sec-polarPlot.html#fig:polarPair">7.9</a>. This plot reveals that
almost all the PM<sub>10</sub> is in the form of PM<sub>2.5</sub> when the wind has an
easterly component, which is attributed to the large secondary
contribution likely dominated by ammonium nitrate.</p>
<p>A simple scatter plot between PM<sub>2.5</sub> and PM<sub>10</sub> strongly suggests a
1:1 relationship and it is not obvious that there is a higher
PM<sub>2.5</sub>/PM<sub>10</sub> ratio when the wind is from the east.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="sec-polarPlot.html#cb55-1" aria-hidden="true"></a><span class="kw">polarPlot</span>(har, <span class="dt">poll =</span> <span class="kw">c</span>(<span class="st">&quot;pm2.5&quot;</span>, <span class="st">&quot;pm10&quot;</span>), </span>
<span id="cb55-2"><a href="sec-polarPlot.html#cb55-2" aria-hidden="true"></a>          <span class="dt">statistic =</span> <span class="st">&quot;robust_slope&quot;</span>,</span>
<span id="cb55-3"><a href="sec-polarPlot.html#cb55-3" aria-hidden="true"></a>          <span class="dt">col =</span> <span class="st">&quot;jet&quot;</span>,</span>
<span id="cb55-4"><a href="sec-polarPlot.html#cb55-4" aria-hidden="true"></a>          <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb55-5"><a href="sec-polarPlot.html#cb55-5" aria-hidden="true"></a>          <span class="dt">ws_spread =</span> <span class="fl">1.5</span>,</span>
<span id="cb55-6"><a href="sec-polarPlot.html#cb55-6" aria-hidden="true"></a>          <span class="dt">wd_spread =</span> <span class="dv">10</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarPair"></span>
<img src="openair_files/figure-html/polarPair-1.png" alt="Use of the `polarPlot` function to investigate the linear regression slope between PM~2.5~ and PM~10~ at Harwell in 2013. In this case the robust slope is calculated." width="50%" />
<p class="caption">
Figure 7.9: Use of the <code>polarPlot</code> function to investigate the linear regression slope between PM<sub>2.5</sub> and PM<sub>10</sub> at Harwell in 2013. In this case the robust slope is calculated.
</p>
</div>
</div>
<div id="sec:polarCluster" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Clustering</h2>
<p>The <code>polarPlot</code> function will often identify interesting features
that would be useful to analyse further. It is possible to select
areas of interest based only on a consideration of a plot. Such a
selection could be based on wind direction and wind speed intervals
for example e.g.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="sec-polarPlot.html#cb56-1" aria-hidden="true"></a>subdata &lt;-<span class="st"> </span><span class="kw">filter</span>(mydata, ws <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>, wd <span class="op">&gt;=</span><span class="st"> </span><span class="dv">180</span>, wd <span class="op">&lt;=</span><span class="st"> </span><span class="dv">270</span>)</span></code></pre></div>
<p>which would select wind speeds &gt;3 m s<sup>-1</sup> and wind directions from 180
to 270 degrees from <code>mydata</code>. That subset of data, <code>subdata</code>,
could then be analysed using other functions. While this approach may
be useful in many circumstances it is rather arbitrary. In fact, the
choice of ‘interesting feature’ in the first place can even depend
on the colour scale used, which is not very robust. Furthermore, many
interesting patterns can be difficult to select and won’t always fall
into convenient intervals of other variables such as wind speed and
direction.</p>
<p>A better approach is to use a method that can select group similar
features together. One such approach is to use <em>cluster analysis</em>. <span class="pkg">openair</span> uses k-means clustering as a way in which
bivariate polar plot features can be identified and grouped. The main
purpose of grouping data in this way is to identify records in the
original time series data by cluster to enable post-processing to
better understand potential source characteristics. The process of
grouping data in k-means clustering proceeds as follows. First, <span class="math inline">\(k\)</span>
points are randomly chosen form the space represented by the objects
that are being clustered into <span class="math inline">\(k\)</span> groups. These points represent
initial group centroids. Each object is assigned to the group that has
the closest centroid. When all objects have been assigned, the
positions of the <span class="math inline">\(k\)</span> centroids is re-calculated. The previous two
steps are repeated until the centroids no longer move. This produces a
separation of the objects into groups from which the metric to be
minimised can be calculated.</p>
<p>Central to the idea of clustering data is the concept of distance
i.e. some measure of similarity or dissimilarity between
points. Clusters should be comprised of points separated by small
distances relative to the distance between the clusters. Careful
consideration is required to define the distance measure used because
the effectiveness of clustering itself fundamentally depends on its
choice. The similarity of concentrations shown in Figure
<a href="sec-polarPlot.html#fig:polarPlot">7.1</a> for example is determined by three variables:
the <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> wind components and the concentration. All three
variables are equally important in characterising the
concentration-location information, but they exist on different scales
i.e. a wind speed-direction measure and a concentration. Let <span class="math inline">\(X = \{x_i\}, i = 1,\ldots,n\)</span> be a set of <span class="math inline">\(n\)</span> points to be clustered into
<span class="math inline">\(K\)</span> clusters, <span class="math inline">\(C = \{c_k, k = 1,\ldots,K\}\)</span>. The basic k-means
algorithm for <span class="math inline">\(K\)</span> clusters is obtained by minimising:</p>
<p><span class="math display" id="eq:clust-1">\[\begin{equation}
 \sum_{k=1}^{K} \sum_{x_i \in c_k} || x_i - \mu_k ||^2 \tag{7.4}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(|| x_i - \mu_k ||^2\)</span> is a chosen distance measure, <span class="math inline">\(\mu_k\)</span> is
the mean of cluster <span class="math inline">\(c_k\)</span>.</p>
<p>The distance measure is defined as the Euclidean distance:</p>
<p><span class="math display" id="eq:clust-2">\[\begin{equation}
d_{x, y} = \left({\sum_{j=1}^{J} (x_j - y_j) ^ 2}\right)^{1/2}  \tag{7.5}
\end{equation}\]</span></p>
<p>Where <strong>x</strong> and <strong>y</strong> are two J-dimensional vectors,
which have been standardized by subtracting the mean and dividing by
the standard deviation. In the current case <span class="math inline">\(J\)</span> is of length three
i.e. the wind components <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> and the concentration <span class="math inline">\(C\)</span>,
each of which is standardized e.g.:</p>
<p><span class="math display" id="eq:clust-3">\[\begin{equation}
x_j = \left(\frac{x_j - \overline{x}}{\sigma_x}\right)  \tag{7.6}
\end{equation}\]</span></p>
<p>Standardization is necessary because the wind components <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span>
are on different scales to the concentration. In principle, more
weight could be given to the concentration rather than the <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span>
components, although this would tend to identify clusters with
similar concentrations but different source origins.</p>
<p><code>polarCluster</code> can be thought of as the ‘local’ version of
clustering of back trajectories. Rather than using air mass origins,
wind speed, wind direction and concentration are used to group similar
conditions together. Section <a href="#sec:trajCluster"><strong>??</strong></a> provides the details of clustering back trajectories in <span class="pkg">openair</span>. A fuller description of the
clustering approach is described in <span class="citation">Carslaw and Beevers (<a href="#ref-CarslawClust2013" role="doc-biblioref">2013</a>)</span>.</p>
<p>The use of the <code>polarCluster</code> is very similar to the use of all
<span class="pkg">openair</span> functions. While there are many techniques available to try
and find the optimum number of clusters, it is difficult for these
approaches to work in a consistent way for identifying features in
bivariate polar plots. For this reason it is best to consider a range
of solutions that covers a number of clusters.</p>
<p>Cluster analysis is computationally intensive and the
<code>polarCluster</code> function can take a comparatively long time to
run. The basic idea is to calculate the solution to several cluster
levels and then choose one that offers the most appropriate solution
for post-processing.</p>
<p>The example given below is for concentrations of SO<sub>2</sub>, shown in Figure
<a href="sec-polarPlot.html#fig:polarPlot3">7.3</a> and the aim is to identify features in that
plot. A range of numbers of clusters will be calculated — in this
case from two to ten.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="sec-polarPlot.html#cb57-1" aria-hidden="true"></a><span class="kw">polarCluster</span>(mydata, <span class="dt">pollutant=</span><span class="st">&quot;so2&quot;</span>, <span class="dt">n.clusters=</span><span class="dv">2</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">cols=</span> <span class="st">&quot;Set2&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarClust"></span>
<img src="openair_files/figure-html/polarClust-1.png" alt="Use of the `polarCluster` function applied to SO~2~ concentrations at Marylebone Road. In this case 2 to 10 clusters have been chosen." width="672" />
<p class="caption">
Figure 7.10: Use of the <code>polarCluster</code> function applied to SO<sub>2</sub> concentrations at Marylebone Road. In this case 2 to 10 clusters have been chosen.
</p>
</div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="sec-polarPlot.html#cb58-1" aria-hidden="true"></a>results &lt;-<span class="st"> </span><span class="kw">polarCluster</span>(mydata, <span class="dt">pollutant=</span><span class="st">&quot;so2&quot;</span>, </span>
<span id="cb58-2"><a href="sec-polarPlot.html#cb58-2" aria-hidden="true"></a>                        <span class="dt">n.clusters =</span> <span class="dv">8</span>, </span>
<span id="cb58-3"><a href="sec-polarPlot.html#cb58-3" aria-hidden="true"></a>                        <span class="dt">cols =</span> <span class="st">&quot;Set2&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:polarClustn6"></span>
<img src="openair_files/figure-html/polarClustn6-1.png" alt="Use of the `polarCluster` function applied to SO~2~ concentrations at Marylebone Road. In this case 8 clusters have been chosen." width="50%" />
<p class="caption">
Figure 7.11: Use of the <code>polarCluster</code> function applied to SO<sub>2</sub> concentrations at Marylebone Road. In this case 8 clusters have been chosen.
</p>
</div>
<p>The real benefit of <code>polarCluster</code> is being able to identify
clusters in the original data frame. To do this, the results from the
analysis must be read into a new variable, as in Figure
<a href="sec-polarPlot.html#fig:polarClustn6">7.11</a>, where the results are read into a data
frame `results}. Now it is possible to use this new information. In
the 8-cluster solution to Figure <a href="sec-polarPlot.html#fig:polarClustn6">7.11</a>, cluster~6
seems to capture the elevated SO<sub>2</sub> concentrations to the east well
(see Figure <a href="sec-polarPlot.html#fig:polarPlot3">7.3</a> for comparison), while cluster 5 will
strongly represent the road contribution.</p>
<p>The results are here:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="sec-polarPlot.html#cb59-1" aria-hidden="true"></a><span class="kw">head</span>(results[[<span class="st">&quot;data&quot;</span>]])</span></code></pre></div>
<pre><code>##     .id                date   ws  wd nox no2 o3 pm10    so2     co pm25
## 1     1 1998-01-01 00:00:00 0.60 280 285  39  1   29 4.7225 3.3725   NA
## 2    10 1998-01-01 09:00:00 3.96 170 113  39  2   12 2.9225 1.2050   NA
## 3   100 1998-01-05 03:00:00 8.76 240  53  24 16   12 1.5950 0.5400   NA
## 4  1000 1998-02-11 15:00:00 7.20 230 372  92  2   49 8.5950 3.7175   NA
## 5 10000 1999-02-21 15:00:00 6.36 290  71  32 20   10 2.6225 1.0500    8
## 6 10001 1999-02-21 16:00:00 7.68 290  85  39 16   12 2.8700 1.4750    9
##         ws2      wd2      ratio cluster
## 1 -3.644413 300.8006 0.01657018       4
## 2  8.097406 205.4476 0.02586283       5
## 3 10.273961 316.2100 0.03009434       4
## 4  5.470734 211.1890 0.02310484       4
## 5  3.362746 349.8437 0.03693662       7
## 6  6.596460 286.0474 0.03376471       7</code></pre>
<p>Note that there is an additional column <code>cluster</code> that gives the
cluster a particular row belongs to and that this is a
<em>character</em> variable. It might be easier to read these results
into a new data frame:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="sec-polarPlot.html#cb61-1" aria-hidden="true"></a>results &lt;-<span class="st"> </span>results[[<span class="st">&quot;data&quot;</span>]]</span></code></pre></div>
<p>It is easy to find out how many points are in each cluster:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="sec-polarPlot.html#cb62-1" aria-hidden="true"></a><span class="kw">table</span>(results[[<span class="st">&quot;cluster&quot;</span>]])</span></code></pre></div>
<pre><code>## 
##     1     2     3     4     5     6     7     8 
##   206   412   160 24133 16049  2590  7925  2832</code></pre>
<p>Now other <span class="pkg">openair</span> analysis functions can be used to analyse the
results. For example, to consider the temporal variations by cluster:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="sec-polarPlot.html#cb64-1" aria-hidden="true"></a><span class="kw">timeVariation</span>(results, <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">group =</span> <span class="st">&quot;cluster&quot;</span>,</span>
<span id="cb64-2"><a href="sec-polarPlot.html#cb64-2" aria-hidden="true"></a>              <span class="dt">key.columns =</span> <span class="dv">4</span>,</span>
<span id="cb64-3"><a href="sec-polarPlot.html#cb64-3" aria-hidden="true"></a>              <span class="dt">col =</span> <span class="st">&quot;Set2&quot;</span>, <span class="dt">ci =</span> <span class="ot">FALSE</span>, <span class="dt">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="figure"><span id="fig:tempEvalClust"></span>
<img src="openair_files/figure-html/tempEvalClust-1.png" alt="Temporal variation in SO~2~ split by cluster." width="864" />
<p class="caption">
Figure 7.12: Temporal variation in SO<sub>2</sub> split by cluster.
</p>
</div>
<p>Or if we just want to plot a couple of clusters (5 and 6) <em>using the same colours</em> as in Figure <a href="sec-polarPlot.html#fig:polarClustn6">7.11</a>:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="sec-polarPlot.html#cb65-1" aria-hidden="true"></a><span class="kw">timeVariation</span>(<span class="kw">filter</span>(results, cluster <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;5&quot;</span>, <span class="st">&quot;6&quot;</span>)),</span>
<span id="cb65-2"><a href="sec-polarPlot.html#cb65-2" aria-hidden="true"></a>              <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>,</span>
<span id="cb65-3"><a href="sec-polarPlot.html#cb65-3" aria-hidden="true"></a>              <span class="dt">group =</span> <span class="st">&quot;cluster&quot;</span>,  </span>
<span id="cb65-4"><a href="sec-polarPlot.html#cb65-4" aria-hidden="true"></a>              <span class="dt">col =</span> <span class="kw">openColours</span>(<span class="st">&quot;Set2&quot;</span>, <span class="dv">8</span>)[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>], <span class="dt">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="figure"><span id="fig:clustTV"></span>
<img src="openair_files/figure-html/clustTV-1.png" alt="Temporal variation in SO~2~ split by cluster --- showing only two clusters." width="864" />
<p class="caption">
Figure 7.13: Temporal variation in SO<sub>2</sub> split by cluster — showing only two clusters.
</p>
</div>
<p><code>polarCluster</code> will work on any surface that can be plotted by
<code>polarPlot</code> e.g. the radial variable does not have to be wind speed
but could be another variable such as temperature. While it is not
always possible for <code>polarCluster</code> to identify all features in a
surface it certainly makes it easier to post-process <code>polarPlot</code>s
using other <span class="pkg">openair</span> functions or indeed other analyses altogether.</p>
<p>Another useful way of understanding the clusters is to use the
<code>timeProp</code> function, which can display a time series as a bar chart
split by a categorical variable (in this case the cluster). In this
case it is useful to plot the time series of SO<sub>2</sub> <em>and</em> show
how much of the concentration is contributed to by each cluster. Such
a plot is shown in Figure <a href="sec-polarPlot.html#fig:timePropPolar">7.14</a>. It is now easy to see
for example that many of the peaks in SO<sub>2</sub> are associated with
cluster 6 (power station sources from the east), seen in Figure
<a href="sec-polarPlot.html#fig:polarClustn6">7.11</a>. Cluster~6 is particularly prominent
during springtime, but those sources also make important contributions
through the whole year.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="sec-polarPlot.html#cb66-1" aria-hidden="true"></a><span class="kw">timeProp</span>(<span class="kw">selectByDate</span>(results, <span class="dt">year =</span> <span class="dv">2003</span>), </span>
<span id="cb66-2"><a href="sec-polarPlot.html#cb66-2" aria-hidden="true"></a>         <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">avg.time =</span> <span class="st">&quot;day&quot;</span>,</span>
<span id="cb66-3"><a href="sec-polarPlot.html#cb66-3" aria-hidden="true"></a>         <span class="dt">proportion=</span> <span class="st">&quot;cluster&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;Set2&quot;</span>, </span>
<span id="cb66-4"><a href="sec-polarPlot.html#cb66-4" aria-hidden="true"></a>         <span class="dt">key.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb66-5"><a href="sec-polarPlot.html#cb66-5" aria-hidden="true"></a>         <span class="dt">key.columns =</span> <span class="dv">8</span>, <span class="dt">date.breaks =</span> <span class="dv">10</span>, </span>
<span id="cb66-6"><a href="sec-polarPlot.html#cb66-6" aria-hidden="true"></a>         <span class="dt">ylab =</span> <span class="st">&quot;so2 (ug/m3)&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:timePropPolar"></span>
<img src="openair_files/figure-html/timePropPolar-1.png" alt="Temporal variation in daily SO~2~ concentration at the Marylebone Road site show by contribution of each cluster for 2003." width="1440" />
<p class="caption">
Figure 7.14: Temporal variation in daily SO<sub>2</sub> concentration at the Marylebone Road site show by contribution of each cluster for 2003.
</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Ashbaugh1985">
<p>Ashbaugh, Lowell L., William C. Malm, and Willy Z. Sadeh. 1985. “A residence time probability analysis of sulfur concentrations at grand Canyon National Park.” <em>Atmospheric Environment (1967)</em> 19 (8): 1263–70. <a href="https://doi.org/10.1016/0004-6981(85)90256-2">https://doi.org/10.1016/0004-6981(85)90256-2</a>.</p>
</div>
<div id="ref-CarslawClust2013">
<p>Carslaw, D. C., and S. D. Beevers. 2013. “Characterising and Understanding Emission Sources Using Bivariate Polar Plots and K-Means Clustering.” <em>Environmental Modelling &amp; Software</em> 40 (0): 325–29. <a href="https://doi.org/10.1016/j.envsoft.2012.09.005">https://doi.org/10.1016/j.envsoft.2012.09.005</a>.</p>
</div>
<div id="ref-Carslaw2006a">
<p>Carslaw, D. C., S. D. Beevers, K. Ropkins, and M. C. Bell. 2006. “Detecting and Quantifying Aircraft and Other on-Airport Contributions to Ambient Nitrogen Oxides in the Vicinity of a Large International Airport.” <em>Atmospheric Environment</em> 40 (28): 5424–34.</p>
</div>
<div id="ref-grange2016">
<p>Grange, Stuart K, Alastair C Lewis, and David C Carslaw. 2016. “Source Apportionment Advances Using Polar Plots of Bivariate Correlation and Regression Statistics.” <em>Atmospheric Environment</em> 145: 128–34.</p>
</div>
<div id="ref-Hastie1990">
<p>Hastie, T. J., and R. J. Tibshirani. 1990. <em>Generalized Additive Models</em>. London: Chapman; Hall.</p>
</div>
<div id="ref-henry2009">
<p>Henry, Ronald, Gary A. Norris, Ram Vedantham, and Jay R. Turner. 2009. “Source Region Identification Using Kernel Smoothing.” Article. <em>Environmental Science &amp; Technology</em> 43 (11): 4090–7. <a href="https://doi.org/%7B10.1021/es8011723%7D">https://doi.org/{10.1021/es8011723}</a>.</p>
</div>
<div id="ref-Uria2014">
<p>Uria-Tellaetxe, I, and D. C. Carslaw. 2014. “Conditional Bivariate Probability Function for Source Identification.” <em>Environmental Modelling &amp; Software</em> 59: 1–9. <a href="https://doi.org/10.1016/j.envsoft.2014.05.002">https://doi.org/10.1016/j.envsoft.2014.05.002</a>.</p>
</div>
<div id="ref-Westmoreland2007">
<p>Westmoreland, E. J., N Carslaw, D. C. Carslaw, A. Gillah, and E. Bates. 2007. “Analysis of Air Quality Within a Street Canyon Using Statistical and Dispersion Modelling Techniques.” <em>Atmospheric Environment</em> 41 (39): 9195–9205.</p>
</div>
<div id="ref-Wood2006">
<p>Wood, S. N. 2006. <em>Generalized Additive Models: An Introduction with R</em>. Chapman; Hall/CRC.</p>
</div>
<div id="ref-Yu2004">
<p>Yu, K. N., Y. P. Cheung, T. Cheung, and R. C. Henry. 2004. “Identifying the Impact of Large Urban Airports on Local Air Quality by Nonparametric Regression.” <em>Atmospheric Environment</em> 38 (27): 4501–7.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec-percentileRose.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec-timeVariation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/polar-plots.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["openair.pdf", "openair.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
