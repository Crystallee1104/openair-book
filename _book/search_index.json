[
["sec-prod-hyspl-traj.html", "A Production of HYSPLIT trajectory files", " A Production of HYSPLIT trajectory files As discussed in Section 18, openair can import pre-calculated trajectory data for specified locations. The data are stored on a Ricardo webserver to make it easy to import 96-hour back trajectory data. Several users have requested how they can run HYSPLIT themselves e.g. for different trajectory start heights or for many locations. This section provides the code necessary to run the HYSPLIT model. The code below assumes that full years are run, but it could be adopted for shorter periods. There are three main parts to producing trajectory files: Download and install the NOAA Hysplit model, somewhere with write access (see below). Download the monthly meteorological (.gbl) files also from the NOAA website. Obtain the code to run Hysplit. To run back trajectories it is necessary to download the meteorological data files. The easiest way to download the meteorological files is using the function below. getMet &lt;- function (year = 2013, month = 1, path_met = &quot;~/TrajData/&quot;) { for (i in seq_along(year)) { for (j in seq_along(month)) { download.file(url = paste0(&quot;ftp://arlftp.arlhq.noaa.gov/archives/reanalysis/RP&quot;, year[i], sprintf(&quot;%02d&quot;, month[j]), &quot;.gbl&quot;), destfile = paste0(path_met, &quot;RP&quot;, year[i], sprintf(&quot;%02d&quot;, month[j]), &quot;.gbl&quot;), mode = &quot;wb&quot;) } } } The function will download monthly met files (each about 120 MB) to the chosen directory. Note that the met data files only need be downloaded once. For example, to download files for 2013: getMet(year = 2013, month = 1:12) The original functions have been modified by Stuart Grange (PhD student at the University of York). It is first necessary on ensure that the stringr and devtools packages are installed. The latter is needed to load some R functions stored as a GitHub gist (some code that can be shared publicly). library(devtools) ## Loading required package: usethis source_gist(&quot;https://gist.github.com/davidcarslaw/c67e33a04ff6e1be0cd7357796e4bdf5&quot;, filename = &quot;run_hysplit.R&quot;) ## Sourcing https://gist.githubusercontent.com/davidcarslaw/c67e33a04ff6e1be0cd7357796e4bdf5/raw/1eb36e223725308934bfa189c30969014e979198/run_hysplit.R ## SHA-1 hash of file is e1d37c75528ac18924fd0c6902318702301fa591 Now there should be several loaded functions, including run_hysplit. To run Hysplit, have a look at the examples here https://gist.github.com/davidcarslaw/c67e33a04ff6e1be0cd7357796e4bdf5. On my Windows machine it is run as follows: data_out &lt;- run_hysplit( latitude = 36.134, longitude = -5.347, runtime = -96, start_height = 10, model_height = 10000, start = 2015, end = &quot;2015-01-10&quot;, hysplit_exec = &quot;~/hysplit4/exec&quot;, hysplit_input = &quot;~/trajData&quot;, hysplit_output = &quot;~/temp&quot;, site = &quot;gibraltar&quot;) The data_out can then be used directly in openair trajectory functions. Most of the options should be self-explanatory but hysplit_exec is the path to the Hysplit executable, hysplit_input is the path to the meteorological files (downloaded as described above) and hysplit_output is the directory where Hysplit will write its temporary files. Once run it is then advisable to store the data somewhere. Save it like: saveRDS(data_out, file = &quot;~/trajProc/myTrajData.rds&quot;) Then it is easy to read in later and use e.g. traj &lt;- readRDS(&quot;~/trajProc/myTrajData.rds&quot;) "]
]
