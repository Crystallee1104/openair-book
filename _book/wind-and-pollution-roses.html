<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Wind and Pollution Roses | openair</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Wind and Pollution Roses | openair" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Wind and Pollution Roses | openair" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="David Carslaw" />


<meta name="date" content="2020-07-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="accessing-uk-air-quality-data.html"/>
<link rel="next" href="polarPlot.html"/>
<script src="libs/header-attrs-2.3/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The openair book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="accessing-uk-air-quality-data.html"><a href="accessing-uk-air-quality-data.html"><i class="fa fa-check"></i><b>3</b> Accessing UK Air Quality Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="accessing-uk-air-quality-data.html"><a href="accessing-uk-air-quality-data.html#acessing-data"><i class="fa fa-check"></i><b>3.1</b> Acessing data</a></li>
<li class="chapter" data-level="3.2" data-path="accessing-uk-air-quality-data.html"><a href="accessing-uk-air-quality-data.html#site-meta-data"><i class="fa fa-check"></i><b>3.2</b> Site Meta Data</a></li>
<li class="chapter" data-level="3.3" data-path="accessing-uk-air-quality-data.html"><a href="accessing-uk-air-quality-data.html#plot-sites-on-a-map"><i class="fa fa-check"></i><b>3.3</b> Plot Sites on a Map</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="wind-and-pollution-roses.html"><a href="wind-and-pollution-roses.html"><i class="fa fa-check"></i><b>4</b> Wind and Pollution Roses</a>
<ul>
<li class="chapter" data-level="4.1" data-path="wind-and-pollution-roses.html"><a href="wind-and-pollution-roses.html#example-of-use"><i class="fa fa-check"></i><b>4.1</b> Example of use</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="polarPlot.html"><a href="polarPlot.html"><i class="fa fa-check"></i><b>5</b> Polar plots</a>
<ul>
<li class="chapter" data-level="5.1" data-path="polarPlot.html"><a href="polarPlot.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="polarPlot.html"><a href="polarPlot.html#nonparametric-wind-regression-nwr"><i class="fa fa-check"></i><b>5.2</b> Nonparametric Wind Regression, NWR</a></li>
<li class="chapter" data-level="5.3" data-path="polarPlot.html"><a href="polarPlot.html#conditional-probability-function-cpf-plot"><i class="fa fa-check"></i><b>5.3</b> Conditional Probability Function (CPF) plot</a></li>
<li class="chapter" data-level="5.4" data-path="polarPlot.html"><a href="polarPlot.html#pairwise-statistics"><i class="fa fa-check"></i><b>5.4</b> Pairwise statistics</a></li>
<li class="chapter" data-level="5.5" data-path="polarPlot.html"><a href="polarPlot.html#the-polarcluster-function-for-feature-identification-and-extraction"><i class="fa fa-check"></i><b>5.5</b> The <code>polarCluster</code> function for feature identification and extraction</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">openair</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="wind-and-pollution-roses" class="section level1" number="4">
<h1><span class="header-section-number">Section 4</span> Wind and Pollution Roses</h1>
<p>The wind rose is a very useful way of summarising meteorological
data. It is particularly useful for showing how wind speed and wind
direction conditions vary by year. The <code>windRose</code> function can
plot wind roses in a variety of ways: summarising all available wind
speed and wind direction data, plotting individual wind roses by year,
and also by month. The latter is useful for considering how
meteorological conditions vary by season.</p>
<p>Data are summarised by direction, typically by 45 or 30<span class="math inline">\(^\circ\)</span>
and by different wind speed categories. Typically, wind speeds are
represented by different width ‘paddles’. The plots show the
proportion (here represented as a percentage) of time that the wind is
from a certain angle and wind speed range.</p>
<p>The <code>windRose</code> function also calculates the percentage of
‘calms’ i.e. when the wind speed is zero. UK Met Office data assigns
these periods to 0 degrees wind direction with valid northerly winds
being assigned to 360 degrees.</p>
<p>The <code>windRose</code> function will also correct for bias when wind
directions are rounded to the nearest 10 degrees but are displayed at
angles that 10 degrees is not exactly divisible into e.g. 22.5
degrees. When such data are binned, some angles i.e. N, E, S, W will
comprise three intervals whereas others will comprise two, which can
lead to significant bias. This issue and its solution is discussed by
<span class="citation">Droppo and Napier (<a href="#ref-droppo2008" role="doc-biblioref">2008</a>)</span> and <span class="citation">Applequist (<a href="#ref-applequist2012" role="doc-biblioref">2012</a>)</span>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>
<strong>openair</strong> uses a simple method to correct for the bias by globally
rescaling the count in each wind direction bin by the number of
directions it represents relative to the average. Thus, the primary
four directions are each reduced by a factor of 0.75 and the remaining
12 directions are multiplied by 1.125.</p>
<div id="example-of-use" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Example of use</h2>
<p>First we load the packages:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="wind-and-pollution-roses.html#cb3-1" aria-hidden="true"></a><span class="kw">library</span>(openair)</span></code></pre></div>
<p>The function is very simply called as shown for Figure
<a href="wind-and-pollution-roses.html#fig:windrose">4.1</a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="wind-and-pollution-roses.html#cb4-1" aria-hidden="true"></a><span class="kw">windRose</span>(mydata)</span></code></pre></div>
<div class="figure"><span id="fig:windrose"></span>
<img src="openair_files/figure-html/Windrose-1.png" alt="Use of `windRose` function to plot wind speed/direction frequencies. Wind speeds are split into the intervals shown by the scale in each panel. The grey circles show the % frequencies." width="50%" />
<p class="caption">
Figure 4.1: Use of <code>windRose</code> function to plot wind speed/direction frequencies. Wind speeds are split into the intervals shown by the scale in each panel. The grey circles show the % frequencies.
</p>
</div>
<p> highlights some interesting differences
between the years. In 2000, for example, there were numerous occasions
when the wind was from the SSW and 2003 clearly had more occasions
when the wind was easterly. It can also be useful to use `type =
“month”} to get an idea of how wind speed and direction vary
seasonally.</p>
<p>\begin{figure}</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="wind-and-pollution-roses.html#cb5-1" aria-hidden="true"></a><span class="kw">windRose</span>(mydata, <span class="dt">type =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">2</span>))</span></code></pre></div>
<img src="openair_files/figure-html/windRoseyear-1.png" width="1\textwidth" />
<p>function to plot wind
speed/direction frequencies by year. Wind speeds are split into
the intervals shown by the scale in each panel. The grey circles
show the 10 and 20 % frequencies.}
{#fig:windroseyear}
\end{figure}</p>
<p>The <code>type} option is very flexible in **openair** and can be used to quickly consider the dependencies between variables. \autoref{sec:cutData} describes the basis of this option in **openair** plot. As an example, consider the question: what are the meteorological conditions that control high and low concentrations of \pmten? By setting</code>type = “pm10”}, <strong>openair</strong> will split the 
concentrations into four <em>quantiles</em> i.e. roughly equal numbers
of points in each level. The plot will then show four different wind
roses for each quantile level, although the default number of levels
can be set by the user — see <code>?cutData} for more details. \autoref{fig:windRsPM10} shows the results of setting</code>type = “pm10”}. For the lowest concentrations of the wind
direction is dominated by northerly winds, and relatively low wind
speeds. By contrast, the highest concentrations (plot furthest right)
are dominated by relatively strong winds from the south-west. It is
therefore very easy to obtain a good idea about the conditions that
tend to lead to high (or low) concentrations of a
pollutant. Furthermore, the `type} option is available in almost
all <strong>openair</strong> functions.</p>
<p>\begin{figure}</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="wind-and-pollution-roses.html#cb6-1" aria-hidden="true"></a><span class="kw">windRose</span>(mydata, <span class="dt">type =</span> <span class="st">&quot;pm10&quot;</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>))</span></code></pre></div>
<img src="openair_files/figure-html/windRsPM10-1.png" width="1\textwidth" />
<p>{#fig:windRsPM10}
\end{figure}</p>
<p>A comparison of the effect that bias has can be seen by plotting the
following. Note the prominent frequencies for W, E and N in particular
that are due to the bias issue discussed by .</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="wind-and-pollution-roses.html#cb7-1" aria-hidden="true"></a><span class="co">## no bias correction</span></span>
<span id="cb7-2"><a href="wind-and-pollution-roses.html#cb7-2" aria-hidden="true"></a><span class="kw">windRose</span>(mydata, <span class="dt">angle =</span> <span class="fl">22.5</span>, <span class="dt">bias.corr =</span> <span class="ot">FALSE</span>)</span>
<span id="cb7-3"><a href="wind-and-pollution-roses.html#cb7-3" aria-hidden="true"></a></span>
<span id="cb7-4"><a href="wind-and-pollution-roses.html#cb7-4" aria-hidden="true"></a><span class="co">## bias correction (the default)</span></span>
<span id="cb7-5"><a href="wind-and-pollution-roses.html#cb7-5" aria-hidden="true"></a><span class="kw">windRose</span>(mydata, <span class="dt">angle =</span> <span class="fl">22.5</span>)</span></code></pre></div>
<p><code>pollutionRose} is a variant of</code>windRose} that is useful for
considering pollutant concentrations by wind direction, or more
specifically the percentage time the concentration is in a particular
range. This type of approach can be very informative for air
pollutant species, as demonstrated by Ronald Henry and co-authors in .</p>
<p>You can produce similar pollution roses using the `pollutionRose}
function in recent versions of <strong>openair</strong>, e.g. as in
:</p>
<p>\begin{figure}</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="wind-and-pollution-roses.html#cb8-1" aria-hidden="true"></a><span class="kw">pollutionRose</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;nox&quot;</span>)</span></code></pre></div>
<img src="openair_files/figure-html/pollutionRose1-1.png" width=".45\textwidth" />
<p>and default `pollutionRose} settings.}
{#fig:pollutionrose1}
\end{figure}</p>
<p><code>pollutionRose} is *wrapper* for</code>windRose}. It simply
replaces the wind speed data series in the supplied data set with
another variable using the argument <code>pollutant} before passing that on to</code>windRose}. It also modifies <code>breaks} to estimate a sensible set of break points for that pollutant and uses a slightly different set of default options (key to right, wedge style plot) but otherwise handles arguments just like the parent</code>windRose}
function.</p>
<p>While  indicates that higher 
concentrations are also associated with the SW, conditioning allows
you to be much informative. For example, conditioning by 
() demonstrates that higher 
concentrations are associated with the SW and much of the higher
concentrations. However, it also highlights a notable 
contribution from the E, most apparent at highest 
concentrations that is obscured in  by a
relatively high background ().</p>
<p>\begin{figure}</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="wind-and-pollution-roses.html#cb9-1" aria-hidden="true"></a><span class="kw">pollutionRose</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;nox&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>))</span></code></pre></div>
<img src="openair_files/figure-html/pollutionRose2-1.png" width="1\textwidth" />
<p>{#fig:pollutionrose2}
\end{figure}</p>
<p><code>pollutionRose} can also usefully be used to show which wind directions dominate the overall concentrations. By supplying the option</code>statistic = “prop.mean”} (proportion contribution to the
mean), a good idea can be gained as to which wind directions
contribute most to overall concentrations, as well as providing
information on the different concentration levels. A simple plot is
shown in , which clearly shows the dominance
of south-westerly winds controlling the overall mean 
concentrations at this site. Indeed, almost half the overall 
concentration is contributed by two wind sectors to the
south-west. The `polarFreq} function can also show this sort of
information, but the pollution rose is more effective because both
length and colour are used to show the contribution. These plots are
very useful for understanding which wind directions control the
overall mean concentrations.</p>
<p>\begin{figure}</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="wind-and-pollution-roses.html#cb10-1" aria-hidden="true"></a><span class="kw">pollutionRose</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;nox&quot;</span>, <span class="dt">statistic =</span> <span class="st">&quot;prop.mean&quot;</span>)</span></code></pre></div>
<img src="openair_files/figure-html/pollRoseAttr-1.png" width=".45\textwidth" />
<p>{#fig:pollRoseAttr}
\end{figure}</p>
<p>It is sometimes useful to more clearly understand the contributions
from wind directions that have low frequencies. For example, for a
pollution rose of there are few occurrences of easterly winds
making it difficult to see how the concentration intervals are made
up. Try:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="wind-and-pollution-roses.html#cb11-1" aria-hidden="true"></a><span class="kw">pollutionRose</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">seg =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>However, each wind sector can be normalised to give a probability
between 0 and 1 to help show the variation within each wind sector
more clearly. An example is shown in 
where for easterly winds it is now clearer that a greater proportion
of the time the concentration is made up of high 
concentrations. In this plot each wind sector is scaled between 0 and
1. Also shown with a black like is an indication of the wind direction
frequency to remind us that winds from the east occur with a low
frequency.</p>
<p>\begin{figure}</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="wind-and-pollution-roses.html#cb12-1" aria-hidden="true"></a><span class="kw">pollutionRose</span>(mydata, <span class="dt">pollutant =</span> <span class="st">&quot;so2&quot;</span>, <span class="dt">normalise =</span> <span class="ot">TRUE</span>, <span class="dt">seg =</span> <span class="dv">1</span>)</span></code></pre></div>
<img src="openair_files/figure-html/pollutionRoseNorm-1.png" width=".45\textwidth" />
<p>normalised by each wind sector.}
{#fig:pollutionroseNorm}
\end{figure}</p>
<p>{#sec:comp-met}</p>
<p>The <code>pollutionRose} function is also useful for comparing two meteorological data sets. In this case a</code>reference’ data set is
compared with a second data set. There are many reasons for doing so
e.g. to see how one site compares with another or for meteorological
model evaluation (more on that in later sections). In this case,
<code>ws} and</code>wd} are considered to the the reference data sets
with which a second set of wind speed and wind directions are to be
compared (<code>ws2} and</code>wd2}). The first set of values is
subtracted from the second and the differences compared. If for
example, <code>wd2} was biased positive compared with</code>wd} then
`pollutionRose} will show the bias in polar coordinates. In its
default use, wind direction bias is colour-coded to show negative bias
in one colour and positive bias in another.</p>
<p>Note that this plot is mostly aimed at showing wind direction
biases. It does also show the wind speed bias . However, in most practical
situations the plot should show both wind speed and direction biases
together. An example of a situation where no wind speed bias would be
shown would be for westerly winds where there was absolutely no bias
between two data sets in terms of westerly wind direction but there
was a difference in wind speed. Users should be aware of this limitation.</p>
<p>In the next example, some artificial wind direction data are generated
by adding a positive bias of 30~degrees with some normally distributed
scatter. Also, the wind speed data are given a positive bias. The
results are shown in . The Figure clearly
shows the mean positive bias in wind direction i.e. the direction is
displaced from north (no bias). The colour scale also shows the extent
to which wind speeds are biased i.e. there is a higher proportion of
positively biased wind speeds shown by the red colour compared with the
negatively biased shown in blue. Also shown in
 is the mean wind speed and direction bias
as numerical values.</p>
<p>Note that the <code>type} option can be used in \autoref{fig:pollRoseComp} e.g.</code>type = “month”} to split the
analysis in useful ways. This is useful if one wanted to see whether a
site or the output from a model was biased for different periods. For
example, `type = “daylight”} would show whether there are biases
between nighttime and daytime conditions.</p>
<p>\begin{figure}</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="wind-and-pollution-roses.html#cb13-1" aria-hidden="true"></a><span class="co">## $example of comparing 2 met sites</span></span>
<span id="cb13-2"><a href="wind-and-pollution-roses.html#cb13-2" aria-hidden="true"></a><span class="co">## first we will make some new ws/wd data with a postive bias</span></span>
<span id="cb13-3"><a href="wind-and-pollution-roses.html#cb13-3" aria-hidden="true"></a>mydata &lt;-<span class="st"> </span><span class="kw">transform</span>(mydata,</span>
<span id="cb13-4"><a href="wind-and-pollution-roses.html#cb13-4" aria-hidden="true"></a>                    <span class="dt">ws2 =</span> ws <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">nrow</span>(mydata)) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb13-5"><a href="wind-and-pollution-roses.html#cb13-5" aria-hidden="true"></a>                    <span class="dt">wd2 =</span> wd <span class="op">+</span><span class="st"> </span><span class="dv">30</span> <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">nrow</span>(mydata)) <span class="op">+</span><span class="st"> </span><span class="dv">30</span>)</span>
<span id="cb13-6"><a href="wind-and-pollution-roses.html#cb13-6" aria-hidden="true"></a></span>
<span id="cb13-7"><a href="wind-and-pollution-roses.html#cb13-7" aria-hidden="true"></a><span class="co">## need to correct negative wd</span></span>
<span id="cb13-8"><a href="wind-and-pollution-roses.html#cb13-8" aria-hidden="true"></a>id &lt;-<span class="st"> </span><span class="kw">which</span>(mydata<span class="op">$</span>wd2 <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb13-9"><a href="wind-and-pollution-roses.html#cb13-9" aria-hidden="true"></a>mydata<span class="op">$</span>wd2[id] &lt;-<span class="st"> </span>mydata<span class="op">$</span>wd2[id] <span class="op">+</span><span class="st"> </span><span class="dv">360</span></span>
<span id="cb13-10"><a href="wind-and-pollution-roses.html#cb13-10" aria-hidden="true"></a></span>
<span id="cb13-11"><a href="wind-and-pollution-roses.html#cb13-11" aria-hidden="true"></a><span class="co">## results show postive bias in wd and ws</span></span>
<span id="cb13-12"><a href="wind-and-pollution-roses.html#cb13-12" aria-hidden="true"></a><span class="kw">pollutionRose</span>(mydata, <span class="dt">ws =</span> <span class="st">&quot;ws&quot;</span>, <span class="dt">wd =</span> <span class="st">&quot;wd&quot;</span>, <span class="dt">ws2 =</span> <span class="st">&quot;ws2&quot;</span>, <span class="dt">wd2 =</span> <span class="st">&quot;wd2&quot;</span>, <span class="dt">grid.line =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="openair_files/figure-html/pollutionRoseComp-1.png" width=".45\textwidth" /></p>
<p>{#fig:pollRoseComp}
\end{figure}</p>
<p>An example of using user-supplied breaks is shown in
. In this case six intervals are chosen
including one that spans $-$0.5 to $+$0.5 that is useful to show wind
speeds that do not change.</p>
<p>\begin{figure}</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="wind-and-pollution-roses.html#cb14-1" aria-hidden="true"></a><span class="co">## add some wd bias to some nighttime hours</span></span>
<span id="cb14-2"><a href="wind-and-pollution-roses.html#cb14-2" aria-hidden="true"></a>id &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw">as.numeric</span>(<span class="kw">format</span>(mydata<span class="op">$</span>date, <span class="st">&quot;%H&quot;</span>)) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">23</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>))</span>
<span id="cb14-3"><a href="wind-and-pollution-roses.html#cb14-3" aria-hidden="true"></a>mydata<span class="op">$</span>wd2[id] &lt;-<span class="st"> </span>mydata<span class="op">$</span>wd[id] <span class="op">+</span><span class="st"> </span><span class="dv">30</span> <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(id)) <span class="op">+</span><span class="st"> </span><span class="dv">120</span></span>
<span id="cb14-4"><a href="wind-and-pollution-roses.html#cb14-4" aria-hidden="true"></a>id &lt;-<span class="st"> </span><span class="kw">which</span>(mydata<span class="op">$</span>wd2 <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb14-5"><a href="wind-and-pollution-roses.html#cb14-5" aria-hidden="true"></a>mydata<span class="op">$</span>wd2[id] &lt;-<span class="st"> </span>mydata<span class="op">$</span>wd2[id] <span class="op">+</span><span class="st"> </span><span class="dv">360</span></span>
<span id="cb14-6"><a href="wind-and-pollution-roses.html#cb14-6" aria-hidden="true"></a></span>
<span id="cb14-7"><a href="wind-and-pollution-roses.html#cb14-7" aria-hidden="true"></a><span class="kw">pollutionRose</span>(mydata, <span class="dt">ws =</span> <span class="st">&quot;ws&quot;</span>, <span class="dt">wd =</span> <span class="st">&quot;wd&quot;</span>, <span class="dt">ws2 =</span> <span class="st">&quot;ws2&quot;</span>, <span class="dt">wd2 =</span> <span class="st">&quot;wd2&quot;</span>,</span>
<span id="cb14-8"><a href="wind-and-pollution-roses.html#cb14-8" aria-hidden="true"></a>              <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">11</span>, <span class="dv">-2</span>, <span class="dv">-1</span>, <span class="fl">-0.5</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">11</span>),</span>
<span id="cb14-9"><a href="wind-and-pollution-roses.html#cb14-9" aria-hidden="true"></a>              <span class="dt">cols =</span> <span class="kw">c</span>(<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;white&quot;</span>, <span class="st">&quot;firebrick&quot;</span>),</span>
<span id="cb14-10"><a href="wind-and-pollution-roses.html#cb14-10" aria-hidden="true"></a>              <span class="dt">grid.line =</span> <span class="dv">5</span>, <span class="dt">type =</span> <span class="st">&quot;daylight&quot;</span>)</span></code></pre></div>
<p><img src="openair_files/figure-html/pollutionRoseComp2-1.png" width=".8\textwidth" /></p>
<p>{#fig:pollRoseComp2}
\end{figure}</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-applequist2012">
<p>Applequist, Scott. 2012. “Wind Rose Bias Correction.” <em>Journal of Applied Meteorology and Climatology</em> 51 (7): 1305–9.</p>
</div>
<div id="ref-droppo2008">
<p>Droppo, James G, and Bruce A Napier. 2008. “Wind Direction Bias in Generating Wind Roses and Conducting Sector-Based Air Dispersion Modeling.” <em>Journal of the Air &amp; Waste Management Association</em> 58 (7): 913–18.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Thanks to Philippe
Barn'eoud of Environment Canada for pointing this issue out.<a href="wind-and-pollution-roses.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="accessing-uk-air-quality-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="polarPlot.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/wind-roses.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["openair.pdf", "openair.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
